<!DOCTYPE html>
<html lang="ja">
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ようこそ、指揮官！</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      h1 {
        color: #1976D2;
        font-weight: 500;
        text-align: center;
        margin-bottom: 30px;
      }
      h2 {
        color: #0D47A1;
        font-weight: 400;
        border-bottom: 2px solid #1976D2;
        padding-bottom: 10px;
        margin-top: 30px;
      }
      .tabs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        padding: 5px;
      }
      .tab {
        padding: 10px 15px;
        cursor: pointer;
        transition: background-color 0.3s;
        text-align: center;
        font-size: 13px;
        margin: 2px;
        border-radius: 4px;
        white-space: nowrap;
      }
      .tab:hover {
        background-color: #E3F2FD;
      }
      .tab.active {
        background-color: #1976D2;
        color: #fff;
      }
      .tab-content {
        display: none;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .tab-content.active {
        display: block;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }
      th {
        background-color: #E3F2FD;
        color: #0D47A1;
        font-weight: 500;
      }
      ul {
        padding-left: 20px;
      }
      li {
        margin-bottom: 10px;
      }
      .button {
        display: inline-block;
        padding: 10px 20px;
        background-color: #1976D2;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .button:hover {
        background-color: #1565C0;
      }
      .button-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
      }
      .button {
        padding: 12px 24px;
        background-color: #1976D2;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }
      .button:hover {
        background-color: #1565C0;
      }
      .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }
      .navigation-buttons .button {
        flex: 1;
        margin: 0 5px;
      }
      
      /* シート名ボタンのコンテナスタイル */
      .sheet-button-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px; /* ここを10pxから15pxに増やしました */
        justify-content: center;
        margin-bottom: 20px;
      }
      
      /* シート名ボタンのスタイル */
      .sheet-button {
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s, transform 0.1s;
        text-align: left;
        width: 90%;
        display: flex;
        align-items: center;
        padding: 12px; /* ここを8pxから12pxに増やしました */
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }
      
      .sheet-button img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 50%;
        margin-right: 16px; /* ここを12pxから16pxに増やしました */
      }
      
      .sheet-button span {
        flex: 1;
      }
      
      .sheet-button:hover {
        background-color: #45a049;
        transform: translateY(-2px);
      }
      
      .sheet-button:active {
        transform: translateY(1px);
      }
      
      /* 移動ボタンのスタイル */
      .navigation-button {
        background-color: #008CBA; /* 青色 */
        color: white;
        padding: 12px 24px;
        margin: 10px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        transition: background-color 0.3s;
      }
      
      .navigation-button:hover {
        background-color: #007B9E;
      }
      
      /* モダンなトグルスイッチのスタイル */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #2196F3;
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .toggle-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
      }

      .toggle-label {
        margin-left: 10px;
      }

      .header-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
      }

      .header-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
        margin-right: 20px;
      }

      h1 {
        color: #1976D2;
        font-weight: 500;
        text-align: center;
        margin: 0;
      }

      /* テーブルのコンテナスタイル */
      .table-container {
        width: 100%;
        overflow-x: auto;
        margin-bottom: 20px;
        white-space: nowrap;
      }

      /* テーブルのスタイル */
      table {
        width: 100%;
        min-width: 600px; /* テーブルの最小幅を設定 */
        border-collapse: collapse;
      }
      .multiline {
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div class="header-container">
      <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/shifty/shifty_help.png?raw=true" alt="ヘッダー画像" class="header-image">
      <h1>ようこそ、指揮官！</h1>
    </div>
    
    <!-- タブヘッダーを動的に生成 -->
    <div class="tabs">
      <? for (var tab of tabs) { ?>
        <div class="tab <? if (tab.id === 'basic') { ?>active<? } ?>" onclick="openTab(event, '<?!= tab.id ?>')">
          <?!= tab.shortLabel ?>
        </div>
      <? } ?>
    </div>

    <div id="basic" class="tab-content active">
      <h2>実行可能な操作</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>操作</th>
              <th>説明</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>★【操作説明】はじめに</strong></td>
              <td>本ページの説明を表示します</td>
            </tr>
            <tr>
              <td><strong>設定を開く</strong></td>
              <td>各種設定の有効化/無効化を行うウィンドウを開きます。</td>
            </tr>
            <tr>
              <td><strong>オプション一括更新</strong></td>
              <td>オプションシートのプルダウンを一括で更新します。</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <h2>設定の有効化/無効化</h2>
      <p>「設定を開く」から以下の設定を変更できます：</p>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>設定項目</th>
              <th>説明</th>
              <th>用途</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>1行ごとに更新</strong></td>
              <td>オプションシートのプルダウンを1行ごとに更新する機能を有効/無効化します。</td>
              <td class="multiline">
                ・数行にわたって一行ずつオプションデータを更新するときに利用ください。<br/>
                ・キャラごとに登録するオプションの種類を更新すると、各装備の数値プルダウンが更新される仕様となっています。<br/>
                ・1行ずつ更新できますが、10行以上を更新するときは更新の遅延を感じるかもしれません。<br/>
                ・一括自動自動をご利用でオプションデータを手動更新するときは、この設定を無効化してください。</td>
            </tr>
            <tr>
              <td><strong>一括更新</strong></td>
              <td>オプションシートのプルダウンを1行ごとに更新する機能を有効/無効化します。</td>
              <td class="multiline">
                ・1行ごとに更新する場合に発生する更新の遅延をなるべく少なくしたい場合に利用ください。<br/>
                ・更新完了までに時間はかかりますが、その間はNIKKEを指揮して地上奪還を目指したり、<br/>
                ・NIKKEたちと交流してみてください！</td>
            </tr>
            <tr>
              <td><strong>サイドバーで表示</strong></td>
              <td>設定ページをサイドバーで表示 OR ポップアップウィンドウで表示を切り替えます。</td>
              <td class="multiline">
                ・スプレッドシートの右側に設定のサイドバーを表示します。<br/>
                ・都度設定を切り替えるときに効果的です！</td>
            </tr>
            <tr>
              <td><strong>起動時に非表示</strong></td>
              <td>スプレッドシート起動時にオプションシートを非表示にする機能を有効/無効化します。</td>
              <td class="multiline">
                ・スプレッドシートを開いたときに本ページを非表示にします。<br/>
                ・ステキなキャラたちがお出迎えするページにご満足いただけたら、非表示にしてください！<br/>
                ・「★【操作説明】はじめに」をクリックしたら、またお会いできます！</td>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <h2>注意事項</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>項目</th>
              <th>説明</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>サイドバーで設定ページを表示中に「サイドバーで表示」を無効化したとき</strong></td>
              <td>
                サイドバーが自動で非表示になります。<br/>
                設定ページを開くには「設定を開く」をクリックしてください。</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <h2>各シートの説明ページへ移動</h2>
      <p>以下のボタンをクリックすると、各シートの説明に移動できます：</p>
      <div class="sheet-button-container">
        <div class="sheet-button" onclick="openTab(event, 'nikke_info')">
          <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/rapi/rapi_1.png?raw=true" alt="基本情報アイコン">
          <span>基本情報シート</span>
        </div>
        <div class="sheet-button" onclick="openTab(event, 'option')">
          <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/anis/anis_1.jpg?raw=true" alt="オプションアイコン">
          <span>オプションシート</span>
        </div>
        <div class="sheet-button" onclick="openTab(event, 'collection')">
          <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/helm/helm_1.jpg?raw=true" alt="コレクションアイコン">
          <span>コレクションシート</span>
        </div>
        <div class="sheet-button" onclick="openTab(event, 'skill')">
          <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/epinel/epinel_1.png?raw=true" alt="スキルアイコン">
          <span>スキルシート</span>
        </div>
        <div class="sheet-button" onclick="openTab(event, 'treasure')">
          <img src="https://github.com/mickitty0511/nikke_admin_google_apps/blob/main/src/imgs/characters/guillotine/guillotine_1.jpg?raw=true" alt="宝ものアイコン">
          <span>宝ものシート</span>
        </div>
      </div>
    </div>

    <div id="nikke_info" class="tab-content">
      <h2>基本情報シート</h2>
      <p>このシートでは、各NIKKEのステータスや育成状況を管理します。</p>
      <ul>
        <li>NIKKEの基本情報（名前、属性など）を入力します。</li>
        <li>各NIKKEの所持状況や育成優先度を記載できます。</li>
      </ul>
      <div class="navigation-buttons">
        <button class="button prev-button" onclick="goToPreviousTab('nikke_info')"></button>
        <button class="button next-button" onclick="goToNextTab('nikke_info')"></button>
      </div>
    </div>

    <div id="skill" class="tab-content">
      <h2>スキルシート</h2>
      <p>このシートでは、NIKKEのスキル情報を管理します。</p>
      <ul>
        <li>各NIKKEのスキルに対するスキルレベルを記録します。</li>
        <li>スキルの優先度を立て管理することができます。</li>
        <li>スキルレベルはプルダウンで選択できます。</li>
      </ul>
      <div class="navigation-buttons">
        <button class="button prev-button" onclick="goToPreviousTab('skill')"></button>
        <button class="button next-button" onclick="goToNextTab('skill')"></button>
      </div>
    </div>

    <div id="option" class="tab-content">
      <h2>オプションシート</h2>
      <p>このシートでは、NIKKEに装備するオプション（装備）の管理を行います。</p>
      <ul>
        <li>オプションの種類、数値を記録します。</li>
        <li>オプション数値の目標と優先度を設定できます。</li>
        <li>オプションとその数値はプルダウンで選択できます。</li>
      </ul>
      <div class="navigation-buttons">
        <button class="button prev-button" onclick="goToPreviousTab('option')"></button>
        <button class="button next-button" onclick="goToNextTab('option')"></button>
      </div>
    </div>

    <div id="collection" class="tab-content">
      <h2>コレクションシート</h2>
      <p>このシートでは、ゲーム内のコレクション要素を管理します。</p>
      <ul>
        <li>各種コレクションの進捗状況を記録します。</li>
        <li>未達成のコレクションや優先度の高いものを把握できます。</li>
        <li>コレクションの段階とレアリティはプルダウンで選択できます。</li>
      </ul>
      <div class="navigation-buttons">
        <button class="button prev-button" onclick="goToPreviousTab('collection')"></button>
        <button class="button next-button" onclick="goToNextTab('collection')"></button>
      </div>
    </div>

    <div id="treasure" class="tab-content">
      <h2>宝ものシート</h2>
      <p>このシートでは、ゲーム内の宝もの（特殊アイテムや報酬）を管理します。</p>
      <ul>
        <li>各宝ものの育成状況を記録します。</li>
        <li>宝ものの優先度や使用計画を立てることができます。</li>
      </ul>
      <div class="navigation-buttons">
        <button class="button prev-button" onclick="goToPreviousTab('treasure')"></button>
        <button class="button next-button" onclick="goToNextTab('treasure')"></button>
      </div>
    </div>

    <!-- 「以降は非表示にする」トグルスイッチを条件付きで追加 -->
    <? if (showToggle) { ?>
      <div class="toggle-container">
        <label class="toggle-switch">
          <input type="checkbox" id="hideHelpToggle">
          <span class="slider"></span>
        </label>
        <span class="toggle-label">以降は操作説明を非表示にする</span>
      </div>
    <? } ?>

    <script>
      // タブの順序を定義
      const tabOrder = ['basic', 'nikke_info', 'option', 'collection', 'skill', 'treasure'];

      /**
       * タブのIDからタブのタイトルを取得する関数
       * @param {string} tabId - タブのID
       * @returns {string} タブの表示名
       */
      function getTabTitle(tabId) {
        const tabTitles = {
          basic: '基本設定',
          nikke_info: '基本情報シート',
          option: 'オプションシート',
          collection: 'コレクションシート',
          skill: 'スキルシート',
          treasure: '宝ものシート'
        };
        return tabTitles[tabId] || '';
      }

      /**
       * 前のタブに移動する関数
       * @param {string} currentTab - 現在のタブのID
       */
      function goToPreviousTab(currentTab) {
        const index = tabOrder.indexOf(currentTab);
        if (index > 0) {
          const prevTab = tabOrder[index - 1];
          openTab(null, prevTab);
        }
      }

      /**
       * 次タブに移動する関数
       * @param {string} currentTab - 現在のタブのID
       */
      function goToNextTab(currentTab) {
        const index = tabOrder.indexOf(currentTab);
        if (index < tabOrder.length - 1) {
          const nextTab = tabOrder[index + 1];
          openTab(null, nextTab);
        }
      }

      /**
       * タブを開く関数
       * @param {Event} evt - イベントオブジェクト
       * @param {string} tabName - 開くタブのID
       */
      function openTab(evt, tabName) {
        var i, tabContent, tabLinks;
        tabContent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabContent.length; i++) {
          tabContent[i].style.display = "none";
          tabContent[i].classList.remove("active");
        }
        tabLinks = document.getElementsByClassName("tab");
        for (i = 0; i < tabLinks.length; i++) {
          tabLinks[i].className = tabLinks[i].className.replace(" active", "");
          if (tabLinks[i].getAttribute('onclick').includes(`'${tabName}'`)) {
            tabLinks[i].className += " active";
          }
        }
        const activeTab = document.getElementById(tabName);
        activeTab.style.display = "block";
        activeTab.classList.add("active");

        // ページ上部にスクロール
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // ナビゲーションボタンのラベルを更新
        updateNavigationButtons(tabName);
      }

      /**
       * ナビゲーションボタンのラベルを更新する関数
       * @param {string} currentTab - 現在のタブのID
       */
      function updateNavigationButtons(currentTab) {
        const index = tabOrder.indexOf(currentTab);
        const prevTab = tabOrder[index - 1];
        const nextTab = tabOrder[index + 1];

        const navigation = document.getElementById(currentTab).querySelector('.navigation-buttons');
        const prevButton = navigation.querySelector('.prev-button');
        const nextButton = navigation.querySelector('.next-button');

        if (prevTab) {
          prevButton.textContent = `${getTabTitle(prevTab)}に移動`;
          prevButton.style.display = 'inline-block';
        } else {
          prevButton.style.display = 'none'; // 最初のタブなら前へボタンを非表示
        }

        if (nextTab) {
          nextButton.textContent = `${getTabTitle(nextTab)}に移動`;
          nextButton.style.display = 'inline-block';
        } else {
          nextButton.style.display = 'none'; // 最後のタブなら次へボタンを非表示
        }
      }

      // 初期表示時にナビゲーションボタンを更新
      document.addEventListener('DOMContentLoaded', () => {
        updateNavigationButtons('basic');
      });

      // トグルスイッチの状態を初期化
      <? if (showToggle) { ?>
        document.addEventListener('DOMContentLoaded', () => {
          google.script.run.withSuccessHandler((hide) => {
            document.getElementById('hideHelpToggle').checked = hide === 'true';
          }).getHideHelpWindow();
        });

        // トグルスイッチの状態が変更されたときに設定を保存
        document.getElementById('hideHelpToggle').addEventListener('change', function() {
          var hide = this.checked;
          google.script.run.setHideHelpWindow(hide);
        });
      <? } ?>
    </script>
  </body>
</html>
